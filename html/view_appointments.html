<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>TURNOS - DONTAR</title>
  <link rel='icon' type='image/png' href='../img/dontar_clinica_medica.png'>
  <link rel="stylesheet" href="../css/style_view_appointments.css">
</head>
<body>
  <header>
    <div class="logo">
      <a href="../index.html">
        <img src="../img/dontar_clinica_medica.png" alt="Dontar">
      </a>
    </div>
  </header>

  <div class="tabla_container">
    <h1>Turnos semanales</h1>

    <div class="navegacion_semanal">
      <button onclick="cambiarSemana(-1)">← Semana anterior</button>
      <span id="rangoSemana"></span>
      <button onclick="cambiarSemana(1)">Semana siguiente →</button>
    </div>

    <table id="tablaTurnos">
      <thead id="theadTurnos"></thead>
      <tbody id="tbodyTurnos"></tbody>
    </table>
  </div>

  <script>
    const horarios = ["09:00", "10:00", "11:00"];

    const scheduleData = {
      "2025-07-07": { "09:00": "Juan", "10:00": null, "11:00": "Ana" },
      "2025-07-08": { "09:00": null, "10:00": "Lucía", "11:00": null },
      "2025-07-09": { "09:00": "Pedro", "10:00": null, "11:00": null },
      "2025-07-10": { "09:00": null, "10:00": null, "11:00": "Ramiro" },
      "2025-07-11": { "09:00": "Nadia", "10:00": "Luis", "11:00": null }
    };

    let offsetSemanal = 0;

    function obtenerLunesDesdeHoy(offset) {
      const hoy = new Date();
      const diaActual = hoy.getDay(); 
      const diferencia = diaActual === 0 ? -6 : 1 - diaActual;
      hoy.setDate(hoy.getDate() + diferencia + offset * 7);
      return hoy;
    }

    function generarFechasSemana(offset) {
      const lunes = obtenerLunesDesdeHoy(offset);
      const fechas = [];

      for (let i = 0; i < 7; i++) {
        const dia = new Date(lunes);
        dia.setDate(lunes.getDate() + i);
        const iso = dia.toISOString().split("T")[0];
        const label = dia.toLocaleDateString("es-AR", { weekday: "short", day: "2-digit", month: "2-digit" });
        const diaSemana = dia.getDay(); // 0 = domingo, 6 = sábado
        fechas.push({ iso, label, diaSemana });
      }

      return fechas;
    }

    function renderTablaTurnos() {
      const fechas = generarFechasSemana(offsetSemanal);
      const thead = document.getElementById("theadTurnos");
      const tbody = document.getElementById("tbodyTurnos");
      const rangoSemana = document.getElementById("rangoSemana");

      rangoSemana.textContent = `${fechas[0].label} al ${fechas[6].label}`;

      thead.innerHTML = "<tr><th>Horario</th>" + fechas.map(f => `<th>${f.label}</th>`).join("") + "</tr>";

      tbody.innerHTML = "";
      horarios.forEach(hora => {
        const fila = document.createElement("tr");
        fila.innerHTML = `<td><strong>${hora}</strong></td>` +
          fechas.map(f => {
            const paciente = scheduleData[f.iso]?.[hora];
            const esFinDeSemana = f.diaSemana === 0 || f.diaSemana === 6;
            const clase = esFinDeSemana ? "cerrado" : (paciente ? "ocupado" : "disponible");
            return `<td class="${clase}">${paciente ?? ""}</td>`;
          }).join("");
        tbody.appendChild(fila);
      });
    }

    function cambiarSemana(delta) {
      offsetSemanal += delta;
      renderTablaTurnos();
    }

    renderTablaTurnos();
  </script>
</body>
</html>
